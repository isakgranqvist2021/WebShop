(()=>{"use strict";const e=class{constructor(){this.alerts=document.getElementById("alerts"),this.template=document.getElementById("alert-template")}displayAlert(e){if("content"in document.createElement("template")){let t=this.template.content.cloneNode(!0).children[0];t.classList.add("alert-"+e.type),t.textContent=e.message,this.alerts.appendChild(t),this.addCloseBtn(t)}}addCloseBtn(e){let t=document.createElement("i");t.addEventListener("click",(t=>e.remove())),t.classList.add("fas","fa-times"),e.appendChild(t)}},t="http://localhost:3000",n=async function(e){try{const n=await fetch(t+e,{method:"GET",headers:{"Content-Type":"application/json"}});return await n.json()}catch(e){Promise.reject(e)}},s=async function(e,n,s){try{const a=await fetch(t+e,{method:"POST",body:n,headers:s});return await a.json()}catch(e){Promise.reject(e)}},a=class{constructor(e){this.pC=document.querySelector("#app-products"),this.cC=document.querySelector("#app-controls"),this.data=null,this.controls=e}async loadProducts(e,t){try{const s=await n(`/api/products?q=${e}&page=${t}`);return Promise.resolve(s)}catch(e){return Promise.reject(e)}}async refresh(e,t){this.data=await this.loadProducts(e,t),this.render(this.data.result.docs);let n=new URL(window.location);return n.searchParams.set("page",t),n.searchParams.set("q",e),window.history.pushState({},"",n),await Promise.resolve(this.data)}async init(e,t){this.data=await this.loadProducts(e,t),this.render(this.data.result.docs),this.cC.innerHTML=this.controls.template(this.data),this.controls.addEventListeners()}render(e){this.pC.innerHTML=e.map((e=>new class{constructor(e){this.product=e}onSalePrice(){let e=(100-this.product.on_sale_percentage)/100;return this.product.price*e}price(){return this.product.on_sale?`\n                <div class="price">\n                    <span class="green">€${Math.round(this.onSalePrice())}</span>\n                    <span class="red">€${this.product.price}</span>\n                </div>`:`\n        <div class="price">\n            <span class="green">€${this.product.price}</span>\n        </div>`}template(){if(this.product.variants.length>0)return`\n            <div class="product-c">\n                ${this.price()}\n                <div class="product-img" style="background-image:url('/uploads/${this.product.variants[0].img.src}')" data-alt="${this.product.variants[0].img.alt}"></div>\n            \n                <div class="product-body">\n                    <p>${this.product.title}</p>\n                    <div class="product-actions">\n                        <a href="/add-to-cart/${this.product._id}" class="btn btn-light">Add To Cart</a>\n                        <a href="/product/${this.product._id}" class="btn btn-secondary">View Product</a>\n                    </div>\n                </div>\n            </div>`}}(e).template())).join("")}},i=class extends a{constructor(){super(),this.product_collection=new URLSearchParams(window.location.search).get("q")}addEventListeners(){document.querySelectorAll(".clickable").forEach((e=>{e.addEventListener("click",(async t=>{let n=await this.refresh(new URLSearchParams(window.location.search).get("q"),e.getAttribute("data-page"));this.cC.innerHTML=this.template(n),this.addEventListeners()}))})),document.querySelector(".select-collection").addEventListener("change",(async e=>{this.product_collection=e.target.value;let t=await this.refresh(e.target.value,1);this.cC.innerHTML=this.template(t),this.addEventListeners()}))}template(e){return`\n        <div class="d-flex justify-content-between align-items-center pb-3">\n            <div class="select">\n                <select class="form-select text-capitalize select-collection">\n                    ${e.collections.map((e=>e!=this.product_collection?`<option value="${e}">${e.replace("_"," ")}</option>`:`<option value="${e}" selected>${e.replace("_"," ")}</option>`))}\n                </select>\n            </div>\n            <div class="pagination-top">\n                <ul class="pagination">\n                    ${e.result.hasPrevPage?`<li class="page-item clickable" data-page=${e.result.prevPage}><a class="page-link">Previous</a></li>`:'<li class="page-item disabled"><a class="page-link">Previous</a></li>'}\n                    ${e.result.hasPrevPage?`<li class="page-item clickable" data-page=${e.result.prevPage}><a class="page-link">${e.result.prevPage}</a></li>`:""}\n                                                      <li class="page-item active"><a class="page-link">${e.result.page}</a></li>\n                    ${e.result.hasNextPage?`<li class="page-item clickable" data-page=${e.result.nextPage}><a class="page-link">${e.result.nextPage}</a></li>`:""}\n                    ${e.result.hasNextPage?`<li class="page-item clickable" data-page=${e.result.nextPage}><a class="page-link">Next</a></li>`:'<li class="page-item disabled"><a class="page-link">Next</a></li>'}\n                </ul>\n            </div>\n        </div>`}};function r(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var o="function"==typeof Symbol&&Symbol.observable||"@@observable",c=function(){return Math.random().toString(36).substring(7).split("").join(".")},l={INIT:"@@redux/INIT"+c(),REPLACE:"@@redux/REPLACE"+c(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+c()}};function d(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const u=function e(t,n,s){var a;if("function"==typeof n&&"function"==typeof s||"function"==typeof s&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof n&&void 0===s&&(s=n,n=void 0),void 0!==s){if("function"!=typeof s)throw new Error(r(1));return s(e)(t,n)}if("function"!=typeof t)throw new Error(r(2));var i=t,c=n,u=[],p=u,h=!1;function m(){p===u&&(p=u.slice())}function g(){if(h)throw new Error(r(3));return c}function v(e){if("function"!=typeof e)throw new Error(r(4));if(h)throw new Error(r(5));var t=!0;return m(),p.push(e),function(){if(t){if(h)throw new Error(r(6));t=!1,m();var n=p.indexOf(e);p.splice(n,1),u=null}}}function f(e){if(!d(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if(h)throw new Error(r(9));try{h=!0,c=i(c,e)}finally{h=!1}for(var t=u=p,n=0;n<t.length;n++)(0,t[n])();return e}function w(e){if("function"!=typeof e)throw new Error(r(10));i=e,f({type:l.REPLACE})}function y(){var e,t=v;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(r(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[o]=function(){return this},e}return f({type:l.INIT}),(a={dispatch:f,subscribe:v,getState:g,replaceReducer:w})[o]=y,a}((function(e={variant:null},t){switch(t.type){case"add":return{data:t.data};default:return e}}));window.onload=()=>{if((new class{constructor(){this.da=new e}init(){const e=new URL(window.location);null!=e.searchParams.get("err")&&this.da.displayAlert({type:"danger",message:e.searchParams.get("err")}),null!=e.searchParams.get("success")&&this.da.displayAlert({type:"success",message:e.searchParams.get("success")}),e.searchParams.delete("err"),e.searchParams.delete("success"),window.history.pushState({},"",e)}}).init(),(new class{constructor(){this.enableDropdowns()}init(){this.nav=document.querySelector("nav"),this.bars=document.querySelector(".open-sidenav"),null!=this.bars&&this.bars.addEventListener("click",(e=>{e.stopPropagation(),this.openSidenav()})),null!=this.nav&&this.nav.addEventListener("click",(e=>e.stopPropagation())),null!=document&&document.addEventListener("click",(()=>{this.bars.classList.remove("isOpen"),this.nav.classList.remove("isOpen")}))}toggleClass(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}openSidenav(){null!=this.nav&&this.toggleClass(this.nav,"isOpen"),null!=this.bars&&this.toggleClass(this.bars,"isOpen")}enableDropdowns(){window.addEventListener("click",(()=>{document.querySelectorAll("[data-dropdown]").forEach((e=>e.classList.remove("open")))})),document.querySelectorAll("[data-toggle]").forEach((e=>{e.addEventListener("click",(t=>{let n=document.querySelector(`[data-dropdown=${e.getAttribute("data-toggle")}]`);n.classList.contains("open")?n.classList.remove("open"):n.classList.add("open"),document.querySelectorAll("[data-dropdown]").forEach((e=>{e.getAttribute("data-dropdown")!=n.getAttribute("data-dropdown")&&e.classList.remove("open")}))}))}))}}).init(),"/sign-up"!=window.location.pathname&&sessionStorage.removeItem("formData"),"/sign-up"===window.location.pathname)(new class{variables(){return{em:document.getElementById("email"),fn:document.getElementById("first_name"),ln:document.getElementById("last_name"),sb:document.querySelector(".btn-primary"),f:document.querySelector(".row.g-3"),fd:()=>null!=sessionStorage.getItem("formData")?JSON.parse(sessionStorage.getItem("formData")):null}}init(){const{em:e,fn:t,ln:n,sb:s,f:a,fd:i}=this.variables();let r=i();null!=r&&(e.value=r.em,t.value=r.fn,n.value=r.ln),s.addEventListener("click",(()=>{document.querySelector("button").disabled=!0,window.sessionStorage.setItem("formData",JSON.stringify({em:e.value,fn:t.value,ln:n.value})),a.submit()}))}}).init();else if(new RegExp(/(\/product\/[a-zA-Z0-9].*)/).test(window.location.pathname))(new class{init(){let e=document.querySelector(".image-picker"),t=document.getElementById("selected-img");null!=e&&null!=t&&Array.from(e.querySelectorAll("img")).forEach((e=>{e.addEventListener("click",(()=>t.src=e.src))}))}}).init(),(new class{init(){null!=document.querySelector(".splide")&&new Splide(".splide",{type:"loop",perPage:3,perMove:1,pagination:!1,drag:!0,breakpoints:{992:{perPage:2},600:{perPage:1}}}).mount()}}).init(),(new class{constructor(){this.form=document.querySelector(".update-product-form"),this.osp=document.querySelector(".osp")}init(){document.querySelector(".toggle-edit-form").addEventListener("click",(e=>{e.stopPropagation(),this.toggle()})),this.form.addEventListener("click",(e=>e.stopPropagation())),window.addEventListener("click",(()=>{this.form.classList.contains("show")&&this.toggle()})),document.querySelector(".form-check").addEventListener("change",(e=>{e.target.checked?this.osp.classList.remove("d-none"):this.osp.classList.add("d-none")}))}toggle(){this.form.classList.contains("show")?this.form.classList.remove("show"):this.form.classList.add("show")}}).init();else if("/products"===window.location.pathname){let e=new URLSearchParams(window.location.search);new a(new i).init(e.get("q")||"all",e.get("page")||1)}else"/admin/add-product"===window.location.pathname&&((new class{constructor(){this.vc=document.getElementById("variant-color"),this.sB=document.querySelector(".btn.btn-secondary"),this.uI=document.getElementById("images"),this.temp={}}init(){this.uI.addEventListener("change",(async e=>{let t=new FormData;t.append("img",e.target.files[0]);const n=await s("/admin/add-product/upload-img",t);this.temp.img={src:n.data.filename,alt:"Variant"}})),this.sB.addEventListener("click",(()=>{u.dispatch({type:"add",data:{color:this.vc.value,...this.temp}}),this.vc.value=null,this.uI.value=null,document.querySelector("#product_variant").classList.remove("active"),document.querySelector("#product_information").classList.add("active"),document.querySelector("#pi").classList.add("show","active"),document.querySelector("#pv").classList.remove("show","active")}))}}).init(),(new class{constructor(){this.product={title:"",price:10,product_collection:"",description:[],on_sale:!1,variants:[]},this.sB=document.querySelector(".btn.btn-primary")}init(){this.sB.addEventListener("click",(()=>this.submit())),u.subscribe((()=>{this.product.variants.push(u.getState().data);let e=document.getElementById("product-variants");e.innerHTML=null,this.product.variants.forEach((t=>{let n=document.createElement("img");n.src="/uploads/"+t.img.src,n.alt=t.img.alt,e.appendChild(n),n.addEventListener("click",(()=>{this.product.variants.splice(this.product.variants.findIndex((e=>e.img.src===n.src))),n.remove()}))}))}))}async submit(){let t={title:document.getElementById("title").value,price:document.getElementById("price").value,product_collection:document.getElementById("product_collection").value,description:[document.getElementById("description").value],on_sale:document.getElementById("on_sale").checked,variants:this.product.variants};try{const n=await s("/admin/add-product",JSON.stringify(t),{"Content-Type":"application/json"});document.querySelector("form").reset(),document.getElementById("product-variants").innerHTML=null,(new e).displayAlert({type:"success",message:n.message});let a=document.getElementById("view-product");a.textContent="View Product",a.href="/product/"+n.data._id}catch(e){return Promise.reject(e)}}}).init())}})();